---
title: "VUE踩坑录"
date: 2020-11-18
slug: "vue some trouble"
draft: false
tags:
- TECH
- Vue
categories:
- Vue
---

## ERP 项目

### 数据库

1. 业务表分库分表
2. 日志表定期归档
3. 异步写入+协程池控制最大连接数

### Kafka

1. 生产者封装
2. 使用go + channel来处理异步回调

### 业务优化

1. 利用go的interface+struct，实现接口多态模式，在保障数据处理链路的逻辑框架统一的前提下，支持各类数据的特殊处理
2. 数据拦截规则配置化
   - 前端界面提供规则设置，表持久化
   - 代码引入包，执行预设的规则表达式
   - 单例模式执行规则解析器的生成及缓存
3. 数据拦截历史持久化
4. 基于状态机概念的异常数据发现
   - 前置状态未处理成功，当前状态记为异常数据
5. 基于自愈机制的异常数据处理
   - 消息队列重试机制，解决一些波动异常
   - 定时任务扫表，区分不同的已重试次数，设置不同的下次重试时间，预留一定时间用于上游处理bug，尽量减少本项目开发人员的维护成本
   - 定时任务扫表，重试到上限的数据应该及时报警
6. 协调者执行 channel的优雅关闭，用于应付多发多接的场景，避免panic
7. redis分布式锁解决数据重复的问题，确保数据处理幂等性
8. 处理步骤分步进行，在最大限度保障消费效率的前提下，提升数据处理性能
9. 利用channel + go来实现数据库SQL的异步写入，隔离 业务数据处理 及痕迹记录两条线的耦合性，以保障业务数据处理准确性及高效率为前提，记录处理痕迹，便于链路追踪



## API 项目

### 数据埋点

关键步骤埋点，用于追踪订单的处理详情，方便后续做订单数据分析

### 总线

利用go的interface+struct，基于DDD理念，定义好整条下单链路的核心步骤顺序，并支持各商家的个性化定制。

### 自动化Mapping

提供可操作的界面化系统，让业务人员可以自主配置商品映射关系，减少了人工维护SQL的成本。

### 幂等性控制

消息队列 + redis + 数据库，多重防护，确保没有重复下单

### 库存熔断

1. 定期调用库存接口，实时更新库存
2. 基于当前单的下单结果，如果没有库存，及时熔断，更新虚拟库存为0，避免因为库存不足，导致大量的用户退单

### 个性化

部分商家交互方式不同，需要读邮件获取结果

